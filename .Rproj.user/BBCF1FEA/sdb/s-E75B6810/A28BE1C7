{
    "contents" : "#' @title Download, Clean and Generate Graphs From USQ Theta Probe Data\n#'\n#'@description This package automates downloading and cleaning data from the\n#'University of Southern Queensland National Centre for Engineering in\n#'Agriculture (NCEA).\n#'\n#'This is a slow process to retrieve all the files from the server.\n#'\n#' @param userid The login provided by NCEA to login via FTP\n#' @param password The password provided by NCEA to login via FTP\n#' @param path Filepath to directory for saving .csv file output. Defaults to\n#' current working directory.\n#'\n#' @details This function will download all the .csv files from the server and\n#' coallate them into one dataframe named \"soil_moisture\" and saves a .csv file\n#' to disk.\n#'\n#' @examples\n#'\nget_soil_moisture <- function(userid = \"\", password  = \"\", path = \"\") {\n\n  path <- .get_data_path(path)\n  JW_01 <- NULL\n  JW_02 <- NULL\n\n  ftp_site <- paste(\"ftp://\", userid, \":\",\n                    password, \"@ftp.usqsoilmoisture.com/public_html/data/\",\n                    sep = \"\")\n\n  filenames <- RCurl::getURL(ftp_site, ftp.use.epsv = FALSE, ftplistonly = TRUE,\n                             crlf = TRUE)\n  filenames <- paste(ftp_site, strsplit(filenames, \"\\r*\\n\")[[1]],\n                     sep = \"\")[-c(1:2)]\n\n  for(i in 1:length(filenames)){\n    subdirectory_filenames <- RCurl::getURL(paste0(filenames[i], \"/\"),\n                                            ftp.use.epsv = FALSE,\n                                            ftplistonly = TRUE, crlf = TRUE,\n                                            verbose = TRUE)\n    subdirectory_filenames <- paste(filenames[i], \"/\",\n                                    strsplit(subdirectory_filenames,\n                                             \"\\r*\\n\")[[1]], sep = \"\")\n\n    include <- grep(\"*.csv\", subdirectory_filenames)\n    csv_files <- subdirectory_filenames[include]\n    include_JW_01 <- grep(\".JW_01.\", csv_files)\n    JW_01 <- append(JW_01, csv_files[include_JW_01])\n    include_JW_02 <- grep(\".JW_02.\", csv_files)\n    JW_02 <- append(JW_02, csv_files[include_JW_02])\n\n    soil_moisture_JW_01 <- data.table::rbindlist(lapply(JW_01, data.table::fread,\n                                                        header = FALSE,\n                                                        select = c(1:3)))\n    soil_moisture_JW_01$Sensor <- rep(\"JW_01\",\n                                      length(soil_moisture_JW_01[, 1]))\n    soil_moisture_JW_02 <- data.table::rbindlist(lapply(JW_02, data.table::fread,\n                                                        header = FALSE,\n                                                        select = c(1:3)))\n    soil_moisture_JW_02$Sensor <- rep(\"JW_02\",\n                                      length(soil_moisture_JW_02[, 1]))\n\n    soil_moisture <- rbind(soil_moisture_JW_01, soil_moisture_JW_02)\n    names(soil_moisture) <- c(\"Date\", \"Time\", \"Moisture\", \"Sensor\")\n\n    readr::write_csv(soil_moisture, paste0(path, \"/\", Sys.Date(),\n                                           \"_Soil_Moisture.csv\"), append = TRUE)\n  }\n\n}\n\n\n# shamelessly borrowed from RJ Hijmans Raster package\n.get_data_path <- function(path) {\n  path <- raster::trim(path)\n  if (path == \"\") {\n    path <- getwd()\n  } else {\n    if (substr(path, nchar(path)-1, nchar(path)) == \"//\") {\n      p <- substr(path, 1, nchar(path) - 2)\n    } else if (substr(path, nchar(path), nchar(path)) == \"/\" |\n               substr(path, nchar(path), nchar(path)) == \"\\\\\") {\n      p <- substr(path, 1, nchar(path) - 1)\n    } else {\n      p <- path\n    }\n    if (!file.exists(p) & !file.exists(path)) {\n      stop(\"File path does not exist: \", path)\n    }\n  }\n  if (substr(path, nchar(path), nchar(path)) != \"/\" &\n      substr(path, nchar(path), nchar(path)) != \"\\\\\") {\n    path <- paste0(path, \"/\")\n  }\n  return(path)\n}\n\n",
    "created" : 1455858008132.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "717541393",
    "id" : "A28BE1C7",
    "lastKnownWriteTime" : 1455862999,
    "path" : "~/Development/ThetaProbe/R/get_soil_moisture.R",
    "project_path" : "R/get_soil_moisture.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}