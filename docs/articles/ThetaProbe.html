<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ThetaProbe • ThetaProbe</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="ThetaProbe">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ThetaProbe</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ThetaProbe.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adamhsparks/ThetaProbe">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>ThetaProbe</h1>
                        <h4 class="author">Adam H. Sparks</h4>
            
            <h4 class="date">2018-06-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adamhsparks/ThetaProbe/blob/master/vignettes/ThetaProbe.Rmd"><code>vignettes/ThetaProbe.Rmd</code></a></small>
      <div class="hidden name"><code>ThetaProbe.Rmd</code></div>

    </div>

    
    
<p>An R package for internal use to retrieve files from the University of Southern Queensland’s NCEA soil probe FTP file server for the Centre for Crop Health’s Summer Crops Pathology group and collate all files while converting five-minute data into daily values and filtering outliers in the five-minute data before generating daily mean values for analysis and graphing.</p>
<div id="load-libraries-for-use-in-r-session" class="section level2">
<h2 class="hasAnchor">
<a href="#load-libraries-for-use-in-r-session" class="anchor"></a>Load libraries for use in R session</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(ThetaProbe)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">library</span>(theme.usq)</a></code></pre></div>
</div>
<div id="using-get_os-to-set-the-filepaths" class="section level2">
<h2 class="hasAnchor">
<a href="#using-get_os-to-set-the-filepaths" class="anchor"></a>Using get_os() to set the filepaths</h2>
<p>Check the operating system first to see what platform R is running on. Set the output file path appropriately.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="cf">if</span>(get_os <span class="op">==</span><span class="st"> "windows"</span>) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  file_path &lt;-<span class="st"> "J:/Summer\ Pathology/Jo\ White/Theta\ Probe\ Files/"</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">} <span class="cf">else</span> <span class="co"># macOS, so</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  file_path &lt;-</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  "/Volumes/centreforcrophealth/Summer\ Pathology/Jo\ White/Theta\ Probe\ Files/"</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="er">}</span></a></code></pre></div>
</div>
<div id="using-get_soil_moisture-to-download-new-data" class="section level2">
<h2 class="hasAnchor">
<a href="#using-get_soil_moisture-to-download-new-data" class="anchor"></a>Using get_soil_moisture() to download new data</h2>
<p>This function, <code><a href="http://www.rdocumentation.org/packages/ThetaProbe/topics/get_soil_moisture">get_soil_moisture()</a></code>, downloads data from the FTP server. The theta probe logger files are made up of several disjoint files that this function will concatenate with any prior data files available locally to create a single master file of the data for cleaning and analysis.</p>
<ul>
<li><p><code>userpwd</code>: provide a valid user name and password to access the FTP server</p></li>
<li><p><code>path</code>: File path to directory for saving a comma separated file (CSV) #’ output. Defaults to current working directory.</p></li>
<li><p><code>local_dirs</code>: File path to directory, which holds previous data logger data monthly file folders, which contain hourly CSV files from theta probe loggers.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/ThetaProbe/topics/get_soil_moisture">get_soil_moisture</a></span>(<span class="dt">userpwd =</span> <span class="st">""</span>,</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">                  <span class="dt">path =</span> <span class="st">"~/Documents/Data/Theta Probe/"</span>,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                  <span class="dt">local_dirs =</span> <span class="st">"~/Documents/Data/Theta Probe/"</span>)</a></code></pre></div>
</div>
<div id="using-clean_theta_data-to-remove-outliers-in-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#using-clean_theta_data-to-remove-outliers-in-the-data" class="anchor"></a>Using clean_theta_data() to remove outliers in the data</h2>
<p>Use a Hampel filter to remove outliers before summarising five-minute data into daily values.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">soil &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ThetaProbe/topics/clean_theta_data">clean_theta_data</a></span>(<span class="dt">csv_in =</span> <span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="st">"~/Documents/Data/Theta Probe/"</span>,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="kw">Sys.Date</span>(),</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="st">"_Soil_Moisture.csv"</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">))</a></code></pre></div>
</div>
<div id="final-formatting-and-graphing" class="section level2">
<h2 class="hasAnchor">
<a href="#final-formatting-and-graphing" class="anchor"></a>Final formatting and graphing</h2>
<div id="name-probes-in-data-file" class="section level3">
<h3 class="hasAnchor">
<a href="#name-probes-in-data-file" class="anchor"></a>Name probes in data file</h3>
<p>The soil probes are referred to as “JW_01” and “JW_02” in the logger files. In this step we will assign the location names in the final file for analysis.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">soil<span class="op">$</span>Probe[soil<span class="op">$</span>Probe <span class="op">==</span><span class="st"> "JW_01"</span>] &lt;-<span class="st"> "Hermitage"</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">soil<span class="op">$</span>Probe[soil<span class="op">$</span>Probe <span class="op">==</span><span class="st"> "JW_02"</span>] &lt;-<span class="st"> "Kingaroy"</span></a></code></pre></div>
</div>
<div id="clean-up-data" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-up-data" class="anchor"></a>Clean up data</h3>
<p>The Hermitage probe was reactivated while in storage and transmitted values. This step removes them from the final data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">soil &lt;-</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span>soil[<span class="kw">which</span>(soil<span class="op">$</span>Probe <span class="op">!=</span><span class="st"> "Hermitage"</span> <span class="op">|</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">               </span>soil<span class="op">$</span>Date <span class="op">&lt;</span><span class="st"> "2017-08-15"</span>), ]</a></code></pre></div>
</div>
</div>
<div id="final-steps-graphing-and-saving-data" class="section level2">
<h2 class="hasAnchor">
<a href="#final-steps-graphing-and-saving-data" class="anchor"></a>Final steps, graphing and saving data</h2>
<div id="graph-data" class="section level3">
<h3 class="hasAnchor">
<a href="#graph-data" class="anchor"></a>Graph data</h3>
<p>Create a graph of the data and store it in a shared location. This makes use of the <em>theme.usq</em> package to apply USQ colours and typography to the graphic.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">theta_graph &lt;-</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(soil, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> Moisture, <span class="dt">colour =</span> Probe)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_manual">scale_colour_manual</a></span>(<span class="dt">values =</span> usq_palette[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)]) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Soil Moisture (%)"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_grid">facet_grid</a></span>(Probe <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_usq</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggsave">ggsave</a></span>(<span class="kw">paste0</span>(<span class="st">"/Daily_Soil_Moisture_Graph_"</span>, <span class="kw">Sys.Date</span>(), <span class="st">".png"</span>),</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">       theta_graph,</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">       <span class="dt">path =</span> file_path)</a></code></pre></div>
</div>
<div id="save-the-cleaned-master-csv-file" class="section level3">
<h3 class="hasAnchor">
<a href="#save-the-cleaned-master-csv-file" class="anchor"></a>Save the cleaned master CSV file</h3>
<p>Save data to disk in a shared location.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/write_delim">write_csv</a></span>(soil,</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">          <span class="kw">paste0</span>(file_path, <span class="st">"Daily_Soil_Moisture_Data_"</span>, <span class="kw">Sys.Date</span>(), <span class="st">".csv"</span>))</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-libraries-for-use-in-r-session">Load libraries for use in R session</a></li>
      <li><a href="#using-get_os-to-set-the-filepaths">Using get_os() to set the filepaths</a></li>
      <li><a href="#using-get_soil_moisture-to-download-new-data">Using get_soil_moisture() to download new data</a></li>
      <li><a href="#using-clean_theta_data-to-remove-outliers-in-the-data">Using clean_theta_data() to remove outliers in the data</a></li>
      <li><a href="#final-formatting-and-graphing">Final formatting and graphing</a></li>
      <li><a href="#final-steps-graphing-and-saving-data">Final steps, graphing and saving data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adam Sparks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
